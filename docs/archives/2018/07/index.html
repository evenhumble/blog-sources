<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>Archives: 2018/7 | DIRTY HANDS QA</title>
  
  <meta name="keywords" content="Automation Testing,Performance Testing,Agile,Testing Tool Usage">
  
  
  <meta name="description" content="Learning, Practice,And Never minded">
  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  
  
  <meta name="theme-color" content="#FFFFFF">
  <meta name="msapplication-TileColor" content="#1BC3FB">
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/css/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class='cover  half'>
      
        
  <h1 class='title'>Material X</h1>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder="" />
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class='menu navgation'>
  <ul class='h-list'>
    
      
        <li>
          <a class="nav home" href="/"
            
            
            id="home">
            <i class='fas fa-rss fa-fw'></i>&nbsp;博文
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/projects/"
            
            
            id="projects">
            <i class='fas fa-code-branch fa-fw'></i>&nbsp;项目
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/friends/"
            
              rel="nofollow"
            
            
            id="friends">
            <i class='fas fa-link fa-fw'></i>&nbsp;友链
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/"
            
              rel="nofollow"
            
            
            id="about">
            <i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header material">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="material"></div>
  </div>

	<div class='wrapper'>
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href='/' >
        
          DIRTY HANDS QA
        
      </a>
			<div class='menu navgation'>
				<ul class='h-list'>
          
  					
  						<li>
								<a class="nav flat-box" href="/"
                  
                  
                  id="home">
									<i class='fas fa-grin fa-fw'></i>&nbsp;示例
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/blog/categories/"
                  
                    rel="nofollow"
                  
                  
                  id="blogcategories">
									<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/blog/tags/"
                  
                    rel="nofollow"
                  
                  
                  id="blogtags">
									<i class='fas fa-hashtag fa-fw'></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/blog/archives/"
                  
                    rel="nofollow"
                  
                  
                  id="blogarchives">
									<i class='fas fa-archive fa-fw'></i>&nbsp;归档
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索" />
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fas fa-search fa-fw" href='javascript:void(0)'></a></li>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="flat-btn fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
        
          <li class='s-toc'><a class="flat-btn fas fa-list fa-fw" href='javascript:void(0)'></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/"
                
                
                id="home">
								<i class='fas fa-clock fa-fw'></i>&nbsp;近期文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/blog/archives/"
                
                  rel="nofollow"
                
                
                id="blogarchives">
								<i class='fas fa-archive fa-fw'></i>&nbsp;文章归档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/projects/"
                
                
                id="projects">
								<i class='fas fa-code-branch fa-fw'></i>&nbsp;开源项目
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/friends/"
                
                  rel="nofollow"
                
                
                id="friends">
								<i class='fas fa-link fa-fw'></i>&nbsp;我的友链
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="https://xaoxuu.com/wiki/material-x/"
                
                  rel="nofollow"
                
                
                id="https:xaoxuu.comwikimaterial-x">
								<i class='fas fa-book fa-fw'></i>&nbsp;主题文档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/"
                
                  rel="nofollow"
                
                
                id="about">
								<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于小站
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class='l_main'>
	
		
  <section class="post-list">
    
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
    
    
      
        
          <div class='post-wrapper'>
            <article class="post reveal ">
  


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2018/07/24/1-junit-perf/">
      junit-perf
    </a>
  </h2>


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    <a href="http:" rel="nofollow">
      
        <img src="https://avatars0.githubusercontent.com/u/21341419?s=460&v=4">
      
      <p>dh-qa</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2018-07-24</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="使用JunitPerf进行性能测试"><a href="#使用JunitPerf进行性能测试" class="headerlink" title="使用JunitPerf进行性能测试"></a>使用JunitPerf进行性能测试</h1><p>以下简单介绍一下如何使用JunitPerf进行性能测试，JunitPerf是基于JUnit4的一个单元性能测试插件，对于会远程调用API测试比较合适，如果想要比较nanosecond 延迟的则需要使用<a href="http://openjdk.java.net/projects/code-tools/jmh/" target="_blank" rel="noopener">JMH</a>.</p>
<h2 id="JunitPerf-依赖声明"><a href="#JunitPerf-依赖声明" class="headerlink" title="JunitPerf 依赖声明"></a>JunitPerf 依赖声明</h2><p>此例子假设使用MAVEN管理项目，所以在POM文件中添加：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.noconnor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junitperf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="构建压力测试类"><a href="#构建压力测试类" class="headerlink" title="构建压力测试类"></a>构建压力测试类</h2><p>假设你想衡量DemoPerfService 类中的getServiceId方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoPerfService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServiceId</span><span class="params">(String userId)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么你可以构建如下的测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Rule</span></span><br><span class="line">    <span class="keyword">public</span> JUnitPerfRule perfTestRule = <span class="keyword">new</span> JUnitPerfRule();</span><br><span class="line">    DemoPerfService demoPerfService;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setupService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.demoPerfService = <span class="keyword">new</span> DemoPerfService();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@JUnitPerfTest</span>(threads = <span class="number">50</span>,durationMs = <span class="number">1200</span>,warmUpMs = <span class="number">100</span>,maxExecutionsPerSecond = <span class="number">110</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getServiceId_withoutTestRequirement</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String result =demoPerfService.getServiceId(<span class="string">"userid"</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        Assert.assertNotNull(result);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>直接运行就可以进行压力测试,默认的测试报告可以在build/reports 目录下获取：</p>
<p><img src="images/ut/junitperf_1.jpg" alt="img"></p>
<p>以下是对于测试类的几点说明：</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>定义说明</th>
<th>Default值或说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Rule</td>
<td>申明为JUnit 的Rule类</td>
<td></td>
</tr>
<tr>
<td>JUnitPerfRule</td>
<td>JUnitPerf 测试规则类</td>
<td></td>
</tr>
<tr>
<td>@JunitPerfTest</td>
<td>声明为性能测试方法</td>
<td></td>
</tr>
<tr>
<td>threads</td>
<td>测试使用的线程数</td>
<td></td>
</tr>
<tr>
<td>durationMs</td>
<td>测试持续时间</td>
<td></td>
</tr>
<tr>
<td>warmUpMs</td>
<td>测试热身时间</td>
<td>热身时间的测试数据不会计算进最后的测试结果</td>
</tr>
<tr>
<td>maxExecutionsPerSecond</td>
<td>方法执行的上限</td>
<td>RateLimiter，控制TPS上限</td>
</tr>
</tbody></table>
<h2 id="对自己的测试设置期望值"><a href="#对自己的测试设置期望值" class="headerlink" title="对自己的测试设置期望值"></a>对自己的测试设置期望值</h2><p>使用@JUnitPerfTestRequirement 可以给性能测试设置期望值，这个annotation的属性有:</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>定义</th>
</tr>
</thead>
<tbody><tr>
<td>percentits</td>
<td>设置例如90%/95%/50% 响应时间的期望</td>
</tr>
<tr>
<td>executionsPerSec</td>
<td>期望每秒执行测试(TPS)</td>
</tr>
<tr>
<td>allowedErrorPercentage</td>
<td>允许错误比例</td>
</tr>
<tr>
<td>minLatency</td>
<td>期望最小延时，如果实际最小延时超过这个数，则失败</td>
</tr>
<tr>
<td>maxLatency</td>
<td>期望最大延时，如果实际最大延时超过这个，则失败</td>
</tr>
<tr>
<td>meanLatency</td>
<td>期望中位数延时</td>
</tr>
</tbody></table>
<p>下面是使用了JUnitPerfTestRequirement的一个测试方法,需要和@JUnitPerfTest一起使用：</p>
<ul>
<li>@JUnitPerfTest 定义了压测的运行参数</li>
<li>@JUnitPerfTestRequirement定义了压测的期望值</li>
</ul>
<p>具体代码如下例:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="meta">@JUnitPerfTest</span>(threads = <span class="number">50</span>,durationMs = <span class="number">1200</span>,warmUpMs = <span class="number">100</span>,maxExecutionsPerSecond = <span class="number">110</span>)</span><br><span class="line">  <span class="meta">@JUnitPerfTestRequirement</span>(percentiles = <span class="string">"90:7,95:7,98:7,99:8"</span>, executionsPerSec = <span class="number">10_000</span>, allowedErrorPercentage = <span class="number">0.10f</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getServiceId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      String result =demoPerfService.getServiceId(<span class="string">"userid"</span>);</span><br><span class="line">      System.out.println(result);</span><br><span class="line">      Assert.assertNotNull(result);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>运行之后，如果发现没有满足JUnitPerfTestRequirement定义，则报错:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.lang.AssertionError: Test throughput threshold not achieved</span><br><span class="line">Expected: is &lt;<span class="keyword">true</span>&gt;</span><br><span class="line">     but: was &lt;<span class="keyword">false</span>&gt;</span><br><span class="line">Expected :is &lt;<span class="keyword">true</span>&gt;</span><br></pre></td></tr></table></figure>

<p>是不是很简单！</p>
<h2 id="设置测试报告地址"><a href="#设置测试报告地址" class="headerlink" title="设置测试报告地址"></a>设置测试报告地址</h2><p>JUnitPerf 有不同的测试报告，个人觉得HTML的测试报告比较实用，具体只需要:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Rule</span></span><br><span class="line"><span class="keyword">public</span> JUnitPerfRule perfTestRule = <span class="keyword">new</span> JUnitPerfRule(<span class="keyword">new</span> HtmlReportGenerator(<span class="string">"perf/report.html"</span>));</span><br></pre></td></tr></table></figure>

<h2 id="完整的例子"><a href="#完整的例子" class="headerlink" title="完整的例子"></a>完整的例子</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Rule</span></span><br><span class="line"><span class="comment">//    public JUnitPerfRule perfTestRule = new JUnitPerfRule(new HtmlReportGenerator("perf/report.html"));</span></span><br><span class="line">    <span class="keyword">public</span> JUnitPerfRule perfTestRule = <span class="keyword">new</span> JUnitPerfRule();</span><br><span class="line">    DemoPerfService demoPerfService;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setupService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.demoPerfService = <span class="keyword">new</span> DemoPerfService();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@JUnitPerfTest</span>(threads = <span class="number">50</span>,durationMs = <span class="number">1200</span>,warmUpMs = <span class="number">100</span>,maxExecutionsPerSecond = <span class="number">110</span>)</span><br><span class="line">    <span class="meta">@JUnitPerfTestRequirement</span>(percentiles = <span class="string">"90:7,95:7,98:7,99:8"</span>, executionsPerSec = <span class="number">10_000</span>, allowedErrorPercentage = <span class="number">0.10f</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getServiceId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String result =demoPerfService.getServiceId(<span class="string">"userid"</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        Assert.assertNotNull(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@JUnitPerfTest</span>(threads = <span class="number">50</span>,durationMs = <span class="number">1200</span>,warmUpMs = <span class="number">100</span>,maxExecutionsPerSecond = <span class="number">110</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getServiceId_withoutTestRequirement</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String result =demoPerfService.getServiceId(<span class="string">"userid"</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        Assert.assertNotNull(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后可以再设定的目录中查看测试报告，测试报告和默认的HTML 测试报告是一致的.</p>
<h2 id="一点问题"><a href="#一点问题" class="headerlink" title="一点问题"></a>一点问题</h2><p>压力测试过程中，有时数据不能复用，举个例子来说，如果想测试完全没有访问redis缓存情况下，通过userid查询的user信息速度，那么压测的时候userid就不能复用，因为一旦访问了就会放入redis缓存而影响结果，这个可以通过使用其他的方法解决，比如曾今使用过BlockingQueue的方法进行过尝试，具体方法如下：</p>
<ol>
<li>读取所有userid的文件</li>
<li>把userid放到一个BlockingQueue中</li>
<li>压测时获取userid通过BlockingQueue去获取</li>
</ol>
<p>这样就解决了数据不能重复的方法，具体方法可以参考如下代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">static</span> BlockingQueue&lt;String&gt; distinctIdQueue ;</span><br><span class="line">    <span class="meta">@Rule</span></span><br><span class="line">    <span class="keyword">public</span> JUnitPerfRule perfTestRule =</span><br><span class="line">            <span class="keyword">new</span> JUnitPerfRule(<span class="keyword">new</span> HtmlReportGenerator(<span class="string">"data/report_test.html"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setupQueue</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        distinctIdQueue = <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;();</span><br><span class="line">        Files.readAllLines(</span><br><span class="line">                Paths.get(<span class="string">"data/userid.txt"</span>)</span><br><span class="line">        ).parallelStream().forEach(</span><br><span class="line">                item-&gt; &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        distinctIdQueue.put(item);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@JUnitPerfTest</span>(threads = <span class="number">50</span>,durationMs = <span class="number">1200</span>,warmUpMs = <span class="number">100</span>,maxExecutionsPerSecond = <span class="number">110</span>)</span><br><span class="line">    <span class="meta">@JUnitPerfTestRequirement</span>(percentiles = <span class="string">"90:7,95:7,98:7,99:8"</span>, executionsPerSec = <span class="number">10_000</span>, allowedErrorPercentage = <span class="number">0.10f</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getServiceId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String uesrId = distinctIdQueue.take();</span><br><span class="line">        String result =demoPerfService.getServiceId(userId);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        Assert.assertNotNull(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/junit/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>junit</a>
        
          <a href="/tags/performance/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>performance</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post reveal ">
  


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2018/07/18/0-ut-junit/">
      Unit Testing Intro
    </a>
  </h2>


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    <a href="http:" rel="nofollow">
      
        <img src="https://avatars0.githubusercontent.com/u/21341419?s=460&v=4">
      
      <p>dh-qa</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2018-07-18</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="Just-DO-It-Unit-Testing"><a href="#Just-DO-It-Unit-Testing" class="headerlink" title="Just DO It - Unit Testing"></a>Just DO It - Unit Testing</h1><p>This is first blog for <strong><em>just do it</em></strong> series. The purpose for the <strong><em>just do it</em></strong> series is quit personal. As an aged tester, I have tried a bunch of different testing. And obviously,I am good at some types, and only have concepts in some other types.But There is no notes taken for these, sometimes it bothers me a lot when I need to explain or demo. Anthoer main reason is that I believe that when you want to test something, you need to understand what you test, it is not only the superficial workflow or business logic, but also some techincal inside. <strong><em>just do it</em></strong> is for all the testings or components I have  experienced and learned. It is like footprints of my long enough tester jouney. And Just Do it is more than any words.</p>
<p>ps: for learning English, I decided to write it in English at first.</p>
<h2 id="Unit-Testing-Paradox"><a href="#Unit-Testing-Paradox" class="headerlink" title="Unit Testing Paradox"></a>Unit Testing Paradox</h2><p>There are many blogs out there claiming Unit Testing is such a good thing for improve product quality,and it is quick and cheap. Some Evangelists even claimed unit testing plays very import role in agile,CI/CD process. But in reality, writing unit testing is very rare in a large amount of companies here China. Why? Why good thing doesn’t happen? It is quick,improving quality, more important is cheap? Why so many people/companies don’t buy in? I don’t know, but I want to dive it for seeking the reason.</p>
<h2 id="JUnit-Try"><a href="#JUnit-Try" class="headerlink" title="JUnit Try"></a>JUnit Try</h2><p>JUnit is a very popular unit testing framework, so Let me try from this.</p>
<h3 id="Build-a-Simple-Demo-Application"><a href="#Build-a-Simple-Demo-Application" class="headerlink" title="Build a Simple Demo Application"></a>Build a Simple Demo Application</h3><p>But hold on,what application is for testing? OK, Let me build to simple ToDoApplication. What Features are included:</p>
<ul>
<li>Create ToDoItem : create a ToDoItem which status is TODO</li>
<li>Update ToDoItme: update a ToDoItem </li>
<li>Delete ToDoItem: set ToDoItem status to deleted</li>
<li>Complete ToDoItem: set ToDoItem status to completed</li>
</ul>
<p>I try to make it as simple as possible, so the demonstrate these futures, I create three classes:</p>
<ul>
<li>ToDOItem: it is an entity, which is used to save to database. Just treat it as a database table</li>
<li>ToDoItemDTO: it is a DTO entity, treat is as input</li>
<li>ToDoItemService: do the transformation, transfer ToDoItemDTO to ToDoItem</li>
</ul>
<p>Here is very simple codes:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToDoItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line">    <span class="keyword">private</span> String details;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> status;</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToDoItemDTO</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line">    <span class="keyword">private</span> String details;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> status=ToDoStatusEnum.TODO.getStatusId();</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToDoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ToDoItem <span class="title">createToDoItem</span><span class="params">(ToDoItemDTO dto)</span></span>&#123;</span><br><span class="line">        ToDoItem toDoItem = <span class="keyword">new</span> ToDoItem();</span><br><span class="line">        toDoItem.setId(UUIDGenerator.generateToDoId());</span><br><span class="line">        toDoItem.setStatus(dto.getStatus());</span><br><span class="line">        toDoItem.setDesc(dto.getDesc());</span><br><span class="line">        toDoItem.setDetails(dto.getDetails());</span><br><span class="line">        toDoItem.setUserId(dto.getUserId());</span><br><span class="line">        <span class="keyword">return</span> toDoItem;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ToDoItem <span class="title">updateToDoItem</span><span class="params">(ToDoItemDTO dto)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createToDoItem(dto);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//todo: should make todo item statue to DELETED</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ToDoItem <span class="title">deleteToDoItem</span><span class="params">(ToDoItemDTO dto)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createToDoItem(dto);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//todo: should make todo item statue to Completed</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ToDoItem <span class="title">completeToDoItem</span><span class="params">(ToDoItemDTO dto)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createToDoItem(dto);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ToDoStatusEnum &#123;</span><br><span class="line">    TODO(<span class="number">0</span>),WIP(<span class="number">1</span>),DONE(<span class="number">2</span>),PENDING(<span class="number">3</span>),DELETED(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStatusId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> statusId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> statusId;</span><br><span class="line"></span><br><span class="line">    ToDoStatusEnum(<span class="keyword">int</span> statusId) &#123;</span><br><span class="line">        <span class="keyword">this</span>.statusId= statusId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Let’s-create-first-JUNIT-Test-cases"><a href="#Let’s-create-first-JUNIT-Test-cases" class="headerlink" title="Let’s create first JUNIT Test cases"></a>Let’s create first JUNIT Test cases</h3><p>It is obviously the input is an instance of ToDoDTO, and the output is ToDoItem and the most important part to test is ToDoService. So first thing first, here is the first one test case for ToDoServicce, to test create todoitem successfully, and the content in DTO should be same as the new created ToDoItem.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.BeforeClass;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToDoServiceTest</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateToDoItem_successful</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ToDoService toDoService; = <span class="keyword">new</span> ToDoService();</span><br><span class="line">        ToDoItemDTO dto = <span class="keyword">new</span> ToDoItemDTO();</span><br><span class="line">        dto.setDesc(<span class="string">"test todo"</span>);</span><br><span class="line">        dto.setDetails(<span class="string">"test todo details"</span>);</span><br><span class="line">        ToDoItem toDoItem =toDoService.createToDoItem(dto);</span><br><span class="line">        Assert.assertEquals(toDoItem.getDesc(),<span class="string">"test todo"</span>);</span><br><span class="line">        Assert.assertEquals(toDoItem.getDetails(),<span class="string">"test todo details"</span>);</span><br><span class="line">        Assert.assertEquals(toDoItem.getStatus(),ToDoStatusEnum.TODO.getStatusId());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here I only use two JUNIT elements, these two elements will be used many many times, if you are writing test codes.</p>
<ul>
<li>@Test: annotation test mark the method as test method</li>
<li>Assert.assertEquals: compare the expected value and actual value</li>
</ul>
<p>It is quit straightforward, when you test something, give the input, process it, and compare the output to the expected value, if meet, pass, otherwise failed.</p>
<h3 id="More-cases"><a href="#More-cases" class="headerlink" title="More cases"></a>More cases</h3><p>After Complete the first case, let’s do more. We want to test more functionalities, like update,delete, complete todoitem. Here you go:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToDoServiceTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ToDoService toDoService;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  ToDoItemDTO dto ;</span><br><span class="line">    <span class="meta">@BeforeClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setupToDoService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        toDoService = <span class="keyword">new</span> ToDoService();</span><br><span class="line">        dto = <span class="keyword">new</span> ToDoItemDTO();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateToDoItem_successful</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        dto.setDesc(<span class="string">"test todo"</span>);</span><br><span class="line">        dto.setDetails(<span class="string">"test todo details"</span>);</span><br><span class="line">        ToDoItem toDoItem =toDoService.createToDoItem(dto);</span><br><span class="line">        Assert.assertEquals(toDoItem.getDesc(),<span class="string">"test todo"</span>);</span><br><span class="line">        Assert.assertEquals(toDoItem.getDetails(),<span class="string">"test todo details"</span>);</span><br><span class="line">        Assert.assertEquals(toDoItem.getStatus(),ToDoStatusEnum.TODO.getStatusId());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateToDoItem_successful</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        dto.setDesc(<span class="string">"update"</span>);</span><br><span class="line">        dto.setDetails(<span class="string">"update"</span>);</span><br><span class="line">        ToDoItem toDoItem =toDoService.createToDoItem(dto);</span><br><span class="line">        Assert.assertEquals(toDoItem.getDesc(),<span class="string">"update"</span>);</span><br><span class="line">        Assert.assertEquals(toDoItem.getDetails(),<span class="string">"update"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteToDoItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ToDoItem toDoItem =toDoService.deleteToDoItem(dto);</span><br><span class="line">        Assert.assertEquals(toDoItem.getStatus(),ToDoStatusEnum.DELETED.getStatusId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completeToDoItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ToDoItem toDoItem =toDoService.deleteToDoItem(dto);</span><br><span class="line">        Assert.assertEquals(toDoItem.getStatus(),ToDoStatusEnum.DELETED.getStatusId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In above codes, I use a new junit annonations:</p>
<ul>
<li>@BeforeClass</li>
</ul>
<p>@BeforeClass is invoked before the test class initialized. So the method and should be static. Here why I used @BeforeClass is because I want to resue the toDoService accross all the test methods. So it should be a static.</p>
<p>And another Junit annotation @Before is simmilar with @BeforeClass.<br>It is invoked before every test method. Here is a sample codes to show it:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JunitAnnotationDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String testString=<span class="string">"First"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        testString = <span class="keyword">this</span>.testString + <span class="string">",setup"</span>;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTestString_First</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(testString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTestString_Second</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(testString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>From the result of System.out.println(this), actually JUNIT use different instance to run the test methods</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">io.hedwig.justdoit.demo.JunitAnnotationDemo@<span class="number">17</span>d10166</span><br><span class="line">First,setup</span><br><span class="line">io.hedwig.justdoit.demo.JunitAnnotationDemo@<span class="number">4f</span>8e5cde</span><br><span class="line">First,setup</span><br></pre></td></tr></table></figure>

<h3 id="Run-the-tests"><a href="#Run-the-tests" class="headerlink" title="Run the tests"></a>Run the tests</h3><p>Back to the ToDoItem unit tests. Run the ToDoServiceTest, there are several errors, here is an example for deleteToDoItem: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.lang.AssertionError: </span><br><span class="line">Expected :<span class="number">0</span></span><br><span class="line">Actual   :<span class="number">4</span></span><br><span class="line"> &lt;Click to see difference&gt;</span><br></pre></td></tr></table></figure>

<p>The target to unit test is to make sure you codes pass the tests quickly. Look back to ToDoService, it is obviously, deleteToDoItem should set the ToDoItem status to DELETE, but the function is omitted. So add the codes to fix it, and re-run the tests to make it all passed. </p>
<h2 id="Unit-Test-Thinking"><a href="#Unit-Test-Thinking" class="headerlink" title="Unit Test Thinking"></a>Unit Test Thinking</h2><p>Actully this process is as known as TDD (Test Driven Development). Before actually complete the real working codes, write test codes first. The purpose of these test codes, I think they could be :</p>
<ul>
<li>Features Definition</li>
<li>Task Tracking Tool</li>
<li>Boundary Checking Tool</li>
</ul>
<p>Why? I think in reality, there are many undocumented features in PRD, no one actually mantained it. Unit Test documents these features.</p>
<p>Also if writes test codes before complete the real codes, then you pass test methods one by one, that means developer complete the sub-tasks one by one, so It is Task Tracking tool. Imaging that, if you want to complete 10 sub-tasks, but you are interruptted every hour by meetings or chattings. Every time develop want to find where to start, just run the unit tests, then start from the failed tests.</p>
<p>There are always boundary cases, write into codes to check, it helps develop to find bugs, and also it could be checked if develop have some new changes.</p>
<h2 id="What-should-be-paid-for-Unit-Tests"><a href="#What-should-be-paid-for-Unit-Tests" class="headerlink" title="What should be paid for Unit Tests"></a>What should be paid for Unit Tests</h2><p>Above cases looks so fascination, Unit Tests could tracking features,tasks, and check the codes when changes happened to ensure your changes are correct. But Why developers still don’t want to write the Unit tests?  Let’s just counting the lines of code in above examples, the truth is that the test codes are more lines than real codes. It is not joke, it happened. So I can understand why developer don’t want to write unit tests, maybe the workload!!</p>
<p>Understand what the develop thoughts are, it is also one of targets in <strong><em>just do it</em></strong> series, try it and then find where the issues are.</p>
<p>Because write testing codes need to take more times, pick what to test and use less test codes to achieve coverages is more critical and practical. </p>
<p><a href="https://github.com/evenhumble/justdo-it/tree/master/ut-cases" target="_blank" rel="noopener">code repo</a></p>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/ut/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>ut</a>
        
          <a href="/tags/justdoit/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>justdoit</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post reveal ">
  


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2018/07/01/1-ansible-in-10-minutes/">
      ansible In 30 Minutes
    </a>
  </h2>


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    <a href="http:" rel="nofollow">
      
        <img src="https://avatars0.githubusercontent.com/u/21341419?s=460&v=4">
      
      <p>dh-qa</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2018-07-01</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="Ansible-Basic-Concept"><a href="#Ansible-Basic-Concept" class="headerlink" title="Ansible Basic Concept"></a>Ansible Basic Concept</h1><p>ansible 是一个操作机器的工具,可以通过编排不同的inventory,组合不同的命令来将日常运维的操作<br>变成可运行的脚本资产,同时也可以积累常用的脚本以便复用.</p>
<p>下面是关于ansible的一些基础概念的脑图,总体而言ansible包括了以下几个概念：</p>
<ul>
<li>inventory: 定义主机,定义操作对象<ul>
<li>Host:主机</li>
<li>Group：不同的主机组合成一个组，一个组下面可以有子组，于是就构成了一个树形结构</li>
</ul>
</li>
<li>variable： 变量，主要用来定义对于操作机器时使用的可变参数</li>
</ul>
<h1 id="Ansible-Installation"><a href="#Ansible-Installation" class="headerlink" title="Ansible Installation"></a>Ansible Installation</h1><ul>
<li>install in MAC</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew unisntall ansible</span><br><span class="line">brew install ansible</span><br></pre></td></tr></table></figure>

<ul>
<li>install in centos</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install epel-release</span><br><span class="line">sudo yum install ansible -y</span><br></pre></td></tr></table></figure>

<h1 id="Configure-hosts-for-ansible-ssh-connector"><a href="#Configure-hosts-for-ansible-ssh-connector" class="headerlink" title="Configure hosts for ansible ssh connector"></a>Configure hosts for ansible ssh connector</h1><ul>
<li>copy ssh key to different hosts</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ssh-keygen</span><br><span class="line">ssh-copy-id remoteuser@remote.server</span><br><span class="line">ssh-keyscan remote.server &gt;&gt; ~/.ssh/known_hosts</span><br></pre></td></tr></table></figure>

<ul>
<li>check ssh connection</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh remoteuser@remote.server</span><br></pre></td></tr></table></figure>

<p>it is done.</p>
<h1 id="Ansible-Ad-hoc-Commands"><a href="#Ansible-Ad-hoc-Commands" class="headerlink" title="Ansible Ad-hoc Commands"></a>Ansible Ad-hoc Commands</h1><p>ansible 命令的pattern 如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;host-pattern&gt; [options]</span><br></pre></td></tr></table></figure>

<p>具体查看ansible 的使用帮助是：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h2 id="ansible-ad-hoc-command-检查安装环境"><a href="#ansible-ad-hoc-command-检查安装环境" class="headerlink" title="ansible ad-hoc command - 检查安装环境"></a>ansible ad-hoc command - 检查安装环境</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible all -m ping -u root</span><br></pre></td></tr></table></figure>

<h2 id="ansible-ad-hoc-command-执行命令"><a href="#ansible-ad-hoc-command-执行命令" class="headerlink" title="ansible ad-hoc command - 执行命令"></a>ansible ad-hoc command - 执行命令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible all -a <span class="string">"/bin/sh echo hello world"</span></span><br></pre></td></tr></table></figure>

<h2 id="ansible-ad-hoc-command-copy-files"><a href="#ansible-ad-hoc-command-copy-files" class="headerlink" title="ansible ad-hoc command - copy files"></a>ansible ad-hoc command - copy files</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web -m copy -a <span class="string">"src=/etc/hosts dest=/tmp/hosts"</span></span><br></pre></td></tr></table></figure>

<h2 id="ansible-ad-hoc-command-yum-install"><a href="#ansible-ad-hoc-command-yum-install" class="headerlink" title="ansible ad-hoc command - yum install"></a>ansible ad-hoc command - yum install</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web -m yum -a <span class="string">"name=acme state=present"</span></span><br></pre></td></tr></table></figure>

<h2 id="ansible-ad-hoc-command-add-user"><a href="#ansible-ad-hoc-command-add-user" class="headerlink" title="ansible ad-hoc command - add user"></a>ansible ad-hoc command - add user</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible all -m user -a <span class="string">"name=foo passsword=&lt;crypted password here&gt;"</span></span><br></pre></td></tr></table></figure>

<h2 id="ansible-ad-hoc-command-download-git-包"><a href="#ansible-ad-hoc-command-download-git-包" class="headerlink" title="ansible ad-hoc command - download git 包"></a>ansible ad-hoc command - download git 包</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web -m git -a <span class="string">"repo=git://foo.example.io/repo.git dest=/src/myapp"</span></span><br></pre></td></tr></table></figure>

<h2 id="ansible-ad-hoc-command-start-service"><a href="#ansible-ad-hoc-command-start-service" class="headerlink" title="ansible ad-hoc command - start service"></a>ansible ad-hoc command - start service</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web -m service -a <span class="string">"name=httpd state=started"</span></span><br></pre></td></tr></table></figure>

<h2 id="ansible-ad-hoc-command-并行运行"><a href="#ansible-ad-hoc-command-并行运行" class="headerlink" title="ansible ad-hoc command - 并行运行"></a>ansible ad-hoc command - 并行运行</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web -a <span class="string">"/sbin/reboot"</span> -f 10</span><br></pre></td></tr></table></figure>

<h2 id="ansible-ad-hoc-command-查看全部系统信息"><a href="#ansible-ad-hoc-command-查看全部系统信息" class="headerlink" title="ansible ad-hoc command - 查看全部系统信息"></a>ansible ad-hoc command - 查看全部系统信息</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible all -m setup</span><br></pre></td></tr></table></figure>

<h2 id="ansible-ad-hoc-command-小结"><a href="#ansible-ad-hoc-command-小结" class="headerlink" title="ansible ad-hoc command 小结"></a>ansible ad-hoc command 小结</h2><p>从以上的例子中我们可以看到ansible的命令一般都会使用如下几点：</p>
<ul>
<li>module: -m </li>
<li>module_args: -a </li>
<li>hosts: all/web/……</li>
</ul>
<p>以上三个组合成为了下面的一个命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible all -m service -a <span class="string">"name=httpd state=started"</span></span><br></pre></td></tr></table></figure>

<p>从python的角度看,可以用伪代码的方式:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">def copy(args=&#123;&#125;):</span><br><span class="line">    <span class="keyword">for</span> kwarg, v <span class="keyword">in</span> args.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"&#123;key&#125;=&#123;value&#125;"</span>.format(key=kwarg, value=v))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="built_in">test</span>(args=&#123;&#125;):</span><br><span class="line">    <span class="keyword">for</span> kwarg, v <span class="keyword">in</span> args.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"&#123;key&#125;=&#123;value&#125;"</span>.format(key=kwarg, value=v))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module_mapping = &#123;</span><br><span class="line">    <span class="string">"copy"</span>: copy,</span><br><span class="line">    <span class="string">"test"</span>: <span class="built_in">test</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ansible(module, module_args):</span><br><span class="line">    func = module_mapping.get(module)</span><br><span class="line">    parsed = module_args.split(<span class="string">" "</span>)</span><br><span class="line">    args = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> module_arg <span class="keyword">in</span> parsed:</span><br><span class="line">        kv = module_arg.split(<span class="string">"="</span>)</span><br><span class="line">        args[kv[0]] = kv[1]</span><br><span class="line">    func(args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    ansible(module=<span class="string">'copy'</span>, module_args=<span class="string">"name=name test=test"</span>)</span><br></pre></td></tr></table></figure>


      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/CI-CD/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>CI/CD</a>
        
          <a href="/tags/ansible/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>ansible</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post reveal ">
  


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2018/07/01/2-Github-Travis/">
      Travis - GithubToolChain-1
    </a>
  </h2>


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    <a href="http:" rel="nofollow">
      
        <img src="https://avatars0.githubusercontent.com/u/21341419?s=460&v=4">
      
      <p>dh-qa</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2018-07-01</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="Github工具系列-Travis"><a href="#Github工具系列-Travis" class="headerlink" title="Github工具系列-Travis"></a>Github工具系列-Travis</h1><p>Travis 是一个持续集成工具，github上的每一次提交都可以触发一次build. 在说Travis之前，先说说持续集成，Continuous Integration(CI)的概念。</p>
<p><a href="https://martinfowler.com/articles/continuousIntegration.html" target="_blank" rel="noopener">CI</a> 这是martin flow关于持续集成的一片文章。CI简而言之就是一个开发的方式，这个方式有别于瀑布式开发中在所有功能(大量代码)完成之后才进行验证，他提倡通过不停的提交一个个小功能(代码2量不那么大)进行验证。很显然采用这种开发方式，会带来频繁的build和test，因此也催生了Jenkins等持续集成的工具。Travis也是这种工具，和Jenkins不同的是，Travis更像一种云服务，不需要你在本地部署。</p>
<p>回到CI这个话题，为什么要采用CI这个方式呢？他有什么好处呢？CI的好处是：</p>
<p>···<br>通过不停的build,test可以对功能，代码获取快速的反馈，进行快速的修复，因此项目的进度实际上是非常稳定的，出现在产品开发完之后，产品，需求方向出现错误会尽可能的避免<br>···</p>
<p>从目前来看，国内很多公司大都采用了CI的方式，大型一些的公司每天都有成千上万的build，test在自动化的进行，没有一个工具来做这些的话，可以想象成本会有多高，也就无从谈起或者实施CI了。有一点比较佩服老外，他们如果觉得方向是正确的，就会想办法通过工具或者其他手段来实现，软件行业的各种思想，大部分都是老外提出的。(critical thinking这个方面也是我自己要好好提高的）</p>
<h2 id="Run-Travis"><a href="#Run-Travis" class="headerlink" title="Run Travis"></a>Run Travis</h2><p>.travis.yml file for JAVA</p>
<h2 id="travis-yml-detail"><a href="#travis-yml-detail" class="headerlink" title=".travis,yml detail"></a>.travis,yml detail</h2><p><a href="https://docs.travis-ci.com/user/for-beginners/" target="_blank" rel="noopener">reference</a></p>
<ul>
<li>Building,testing,deployment</li>
<li>Builds,Jobs,Stages and Phases <ul>
<li>phases, sequential steps of a jab</li>
<li>build, a group of jobs</li>
<li>job, serveral phases</li>
<li>stage</li>
</ul>
</li>
<li>travis phases:<ul>
<li>before_install</li>
<li>install</li>
<li>before_script</li>
<li>script</li>
</ul>
</li>
</ul>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/CI-CD/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>CI/CD</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post reveal ">
  


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2018/07/01/1-CleanlyTestData/">
      马桶测试-1： 创建干净的测试数据
    </a>
  </h2>


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    <a href="http:" rel="nofollow">
      
        <img src="https://avatars0.githubusercontent.com/u/21341419?s=460&v=4">
      
      <p>dh-qa</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2018-07-01</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="马桶测试-1：-创建干净的测试数据"><a href="#马桶测试-1：-创建干净的测试数据" class="headerlink" title="马桶测试-1： 创建干净的测试数据"></a>马桶测试-1： 创建干净的测试数据</h1><p>Google Testing on the Toilet Series 翻译第一篇,创建干净的测试数据</p>
<p>原文 <a href="https://testing.googleblog.com/2018/02/testing-on-toilet-cleanly-create-test.html" target="_blank" rel="noopener">Origin Testing on the Toilet: Cleanly Create Test Data</a></p>
<p>Helper方法让创建数据非常方便，但是随着时间的推移，不同的变量数据创建方法加入之后，代码可读性变得不那么好了.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This helper method starts with just a single parameter:</span></span><br><span class="line">Company company = newCompany(PUBLIC);</span><br><span class="line"></span><br><span class="line"><span class="comment">// But soon it acquires more and more parameters.</span></span><br><span class="line"><span class="comment">// Conditionals creep into the newCompany() method body to handle the nulls,</span></span><br><span class="line"><span class="comment">// and the method calls become hard to read due to the long parameter lists:</span></span><br><span class="line">Company small = newCompany(<span class="number">2</span>, <span class="number">2</span>, <span class="keyword">null</span>, PUBLIC);</span><br><span class="line">Company privatelyOwned = newCompany(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, PRIVATE);</span><br><span class="line">Company bankrupt = newCompany(<span class="keyword">null</span>, <span class="keyword">null</span>, PAST_DATE, PUBLIC);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Or a new method is added each time a test needs a different combination of fields:</span></span><br><span class="line">Company small = newCompanyWithEmployeesAndBoardMembers(<span class="number">2</span>, <span class="number">2</span>, PUBLIC);</span><br><span class="line">Company privatelyOwned = newCompanyWithType(PRIVATE);</span><br><span class="line">Company bankrupt = newCompanyWithBankruptcyDate(PAST_DATE, PUBLIC);</span><br></pre></td></tr></table></figure>

<p>为了让测试数据代码更据可读性，使用builder pattern，通过返回部分数据的builder类来创建数据，修改不同的状态是一个不错的方法。 创建数据的方法可以生成部分的默认数据，之后再修改需要修改的数据，可以让测试代码方便而且容易阅读，如下例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Company small = newCompany().setEmployees(<span class="number">2</span>).setBoardMembers(<span class="number">2</span>).build();</span><br><span class="line">Company privatelyOwned = newCompany().setType(PRIVATE).build();</span><br><span class="line">Company bankrupt = newCompany().setBankruptcyDate(PAST_DATE).build();</span><br><span class="line">Company arbitraryCompany = newCompany().build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Zero parameters makes this method reusable for different variations of Company.</span></span><br><span class="line"><span class="comment">// It also doesn’t need conditionals to ignore parameters that aren’t set (e.g. null</span></span><br><span class="line"><span class="comment">// values) since a test can simply not set a field if it doesn’t care about it.</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Company.<span class="function">Builder <span class="title">newCompany</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Company.newBuilder().setType(PUBLIC).setEmployees(<span class="number">100</span>); <span class="comment">// Set required fields</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时测试不应该以来任何的默认值，如果有依赖就让使用者必须去了解具体的创建数据方法的实现了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This test needs a public company, so explicitly set it.</span></span><br><span class="line"><span class="comment">// It also needs a company with no board members, so explicitly clear it.</span></span><br><span class="line">Company publicNoBoardMembers = newCompany().setType(PUBLIC).clearBoardMembers().build();</span><br></pre></td></tr></table></figure>

<p>更多详细信息可以参考：<a href="http://www.natpryce.com/articles/000714.html" target="_blank" rel="noopener">http://www.natpryce.com/articles/000714.html</a></p>
<h2 id="附上原文："><a href="#附上原文：" class="headerlink" title="附上原文："></a>附上原文：</h2><p>This article was adapted from a Google Testing on the Toilet (TotT) episode. You can download a printer-friendly version of this TotT episode and post it in your office.<br>By Ben Yu<br>Helper methods make it easier to create test data. But they can become difficult to read over time as you need more variations of the test data to satisfy constantly evolving requirements from new tests:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This helper method starts with just a single parameter:</span></span><br><span class="line">Company company = newCompany(PUBLIC);</span><br><span class="line"></span><br><span class="line"><span class="comment">// But soon it acquires more and more parameters.</span></span><br><span class="line"><span class="comment">// Conditionals creep into the newCompany() method body to handle the nulls,</span></span><br><span class="line"><span class="comment">// and the method calls become hard to read due to the long parameter lists:</span></span><br><span class="line">Company small = newCompany(<span class="number">2</span>, <span class="number">2</span>, <span class="keyword">null</span>, PUBLIC);</span><br><span class="line">Company privatelyOwned = newCompany(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, PRIVATE);</span><br><span class="line">Company bankrupt = newCompany(<span class="keyword">null</span>, <span class="keyword">null</span>, PAST_DATE, PUBLIC);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Or a new method is added each time a test needs a different combination of fields:</span></span><br><span class="line">Company small = newCompanyWithEmployeesAndBoardMembers(<span class="number">2</span>, <span class="number">2</span>, PUBLIC);</span><br><span class="line">Company privatelyOwned = newCompanyWithType(PRIVATE);</span><br><span class="line">Company bankrupt = newCompanyWithBankruptcyDate(PAST_DATE, PUBLIC);</span><br></pre></td></tr></table></figure>

<p>Instead, use the test data builder pattern: create a helper method that returns a partially-built object (e.g., a Builder in languages such as Java, or a mutable object) whose state can be overridden in tests. The helper method initializes logically-required fields to reasonable defaults, so each test can specify only fields relevant to the case being tested:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Company small = newCompany().setEmployees(<span class="number">2</span>).setBoardMembers(<span class="number">2</span>).build();</span><br><span class="line">Company privatelyOwned = newCompany().setType(PRIVATE).build();</span><br><span class="line">Company bankrupt = newCompany().setBankruptcyDate(PAST_DATE).build();</span><br><span class="line">Company arbitraryCompany = newCompany().build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Zero parameters makes this method reusable for different variations of Company.</span></span><br><span class="line"><span class="comment">// It also doesn’t need conditionals to ignore parameters that aren’t set (e.g. null</span></span><br><span class="line"><span class="comment">// values) since a test can simply not set a field if it doesn’t care about it.</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Company.<span class="function">Builder <span class="title">newCompany</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Company.newBuilder().setType(PUBLIC).setEmployees(<span class="number">100</span>); <span class="comment">// Set required fields</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Also note that tests should never rely on default values that are specified by a helper method since that forces readers to read the helper method’s implementation details in order to understand the test.<br>// This test needs a public company, so explicitly set it.<br>// It also needs a company with no board members, so explicitly clear it.<br>Company publicNoBoardMembers = newCompany().setType(PUBLIC).clearBoardMembers().build();<br>You can learn more about this topic at <a href="http://www.natpryce.com/articles/000714.html" target="_blank" rel="noopener">http://www.natpryce.com/articles/000714.html</a></p>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/google-test-blog-translation/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>google_test_blog_translation</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post reveal ">
  


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2018/07/01/2-CleanCode/">
      Clean Code Reading Note
    </a>
  </h2>


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    <a href="http:" rel="nofollow">
      
        <img src="https://avatars0.githubusercontent.com/u/21341419?s=460&v=4">
      
      <p>dh-qa</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2018-07-01</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="Clean-Code-The-Art-of-Readable-Code-Reading-Notes"><a href="#Clean-Code-The-Art-of-Readable-Code-Reading-Notes" class="headerlink" title="Clean Code/The Art of Readable Code Reading Notes"></a>Clean Code/The Art of Readable Code Reading Notes</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">知易行难</span><br><span class="line">理念可能都有，那么怎么做呢？</span><br></pre></td></tr></table></figure>

<p>匆匆看过两本书，两本书提供了一些如何写好代码的纲领，当时很明显真要写好不是读完两本书就可以的。多练，多思考才可以。两本书有不少比较相似的内容，所以很明显这些相似的内容就是日常需要关注的地方，不管是注释，方法命名，变量命名，重构这些都是日常工作中时刻注意的。</p>
<p>Clean Code和The Art of Readable Code看完对于我来说，更多的是对于作者面面俱到细节的描述惊讶，居然有人能把这些琐碎的事情说的这么完整和逻辑感十足。可以说健壮的代码关于细节的处理是相当的繁琐，把繁琐的事情写成Clean Code不是一件容易事情，我们不缺理念，我们缺的是细节，谁都说我要写漂亮整齐的代码，然后怎么做到呢？我们抱怨别人的代码混乱，但是我们重写真的可以写的刚好吗？如果我们想写的好，那要如何去做呢？这本书给出了一些答案，而这些就是我学习的要点。</p>
<h2 id="Clean-Code-chapter-1介绍"><a href="#Clean-Code-chapter-1介绍" class="headerlink" title="Clean Code-chapter 1介绍"></a>Clean Code-chapter 1介绍</h2><p>这个章节讲述了几个关于混乱代码的伤害(实际上是关于公司/产品的生存问题)，引用了不同技术大牛对于Clean Code的一些看法同时引出下面作者要写的关于Clean code的内容。大多数大牛们的说法都比价抽象，所以能记住的不多，下面是个印象比较的说法：</p>
<ul>
<li><figure class="highlight plain"><figcaption><span>Equals Never```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- 没有测试代码，就没有Clean Code(当然是TDD派)</span><br><span class="line">- 没有重复代码，可读性好，小块代码</span><br><span class="line">- 童子军军规：让营地比你来的时更干净，一点点清理，一点点消除，慢慢变成clean code</span><br><span class="line">- 读代码：写代码=10:1，读远远超过写，为什么需要Clean Code了？</span><br><span class="line"></span><br><span class="line">## Clean Code 的一些基本常识</span><br><span class="line"></span><br><span class="line">- 起名字的艺术，有意义的名字，变量，函数，参数，类，包等等</span><br><span class="line">   * 名副其实</span><br><span class="line">   * 避免误导，缩写/拼硬真的都知道吗</span><br><span class="line">   * 有意义的区分</span><br><span class="line">   ```java</span><br><span class="line">    copy(int[] a1,int a2[])</span><br><span class="line">    //不如</span><br><span class="line">    copy(int[] source,int[] dest)</span><br></pre></td></tr></table></figure>

<ul>
<li>读的出来的名字</li>
<li>每个概念对应一个词，在一个应用中保持一致</li>
<li>使用已有解决方案领域的名称，比如遵循常用Design-pattern中的名称</li>
<li>使用业务领域中名称</li>
<li>添加有意义的语境名称，不使用无意义的语境名称</li>
</ul>
</li>
<li><p>函数</p>
<ul>
<li>函数名称，描述性，动词和关键字</li>
<li>函数变量，参数名称尽量有意义，数量尽量小于3个，善用可变参数</li>
<li>短小尤其是高层的函数，尽量有意义的函数组合而成(&lt;3000 行)</li>
<li>只做一件事情</li>
<li>少用switch</li>
<li>无副作用，比如调用有前提条件，需要注意如何更优雅的处理</li>
<li>setIfExist</li>
<li>Exception 替代返回错误代码</li>
<li>抽离try/catch的代码</li>
<li>DRY:Don’t Repeat Yourself</li>
<li>一个入口一个出口(一个return)</li>
</ul>
</li>
<li><p>注释</p>
<ul>
<li>法律信息</li>
<li>代码就是注释，给变量，函数起个好名字胜过很多注释</li>
<li>提供信息的注释，避免无意义或者和代码不同步的注释</li>
<li>警示，提醒可能修改时遇到问题</li>
<li>TODO</li>
<li>放大某种看来不合理的问题，说明trade-off的情况或者特别处理的意义</li>
<li>修改的日志，修改的comments</li>
</ul>
</li>
<li><p>格式<br>格式是没有太多好说的，或许用一个stylecheck的工具更为好.</p>
</li>
<li><p>对象和数据结构</p>
<ul>
<li>模块不应该了解它内部的对象情形</li>
<li>DTO 通信/ActiveRecord-find/search， 这些是数据结构，不要有业务逻辑</li>
<li>对象暴露行为，隐藏数据/数据结构暴露数据，不要有明显的行为</li>
</ul>
</li>
<li><p>异常处理</p>
<ul>
<li>异常而非返回码</li>
<li>使用Runtime Exception</li>
<li>异常信息</li>
<li>定义常规流程，不要返回NULL</li>
</ul>
</li>
<li><p>单元测试</p>
<ul>
<li>TDD，测试代码和业务代码，保持测试代码整齐(让人可以维护)</li>
<li>测试代码可读性，确保一致可以延续下去和业务保持同步(code-review,如何解决代码量打得大的问题)</li>
<li>DSL Domain测试语言</li>
<li>FIRST: Fast/Independent/Repeatable/Self-Validating/Timely</li>
</ul>
</li>
<li><p>类</p>
<ul>
<li>短小，SRP</li>
<li>接口隔离/隔离修改</li>
<li>DIP</li>
</ul>
</li>
<li><p>系统</p>
<ul>
<li>DIP</li>
<li>工厂方法</li>
<li>scale out</li>
<li>JDK代理/Proxy invocation handler/AOP/AspectJ</li>
</ul>
</li>
<li><p>迭代</p>
<ul>
<li>Run all the tests</li>
<li>Refactor</li>
</ul>
</li>
<li><p>Concurrence</p>
<ul>
<li>并发防御： SRP，Immutable Data,数据副本</li>
<li>ReentrantLock/Sempaphore/CoundDownLatch</li>
<li>执行模型</li>
</ul>
<p>|互斥|每一个时刻只有一个线程访问共享数据和资源|<br>|线程饥饿|比如总是执行快的线程执行|<br>|死锁|两个或者多个线程相互等待|<br>|活锁|执行次序一致的线程|</p>
<ul>
<li>producer-consumer</li>
<li>reader-writer</li>
<li>保持同步区域微小</li>
<li>关闭资源</li>
<li>测试线程代码/注意偶发时间(design for failure)</li>
<li>多平台/多处理器</li>
<li>stub codes/yield??</li>
</ul>
</li>
<li><p>逐步改进</p>
<ul>
<li>work first</li>
<li>一步一步Refactor，from one big method to well-orgainized</li>
<li>unit testing for refactor</li>
</ul>
</li>
<li><p>味道和启发，需要细读</p>
<ul>
<li>移除不必要的注释</li>
<li>函数参数不要过多，移除没有使用的函数</li>
<li>extract重复代码</li>
<li>测试不足，使用覆盖率工具，忽律的测试是不确定的，边界条件</li>
<li>缺陷扎堆</li>
</ul>
</li>
</ul>
<h2 id="The-Art-of-Readable-Code"><a href="#The-Art-of-Readable-Code" class="headerlink" title="The Art of Readable Code"></a>The Art of Readable Code</h2><h3 id="表面层次的改进"><a href="#表面层次的改进" class="headerlink" title="表面层次的改进"></a>表面层次的改进</h3><ul>
<li>naming，变量，函数，参数，类，包命名，有意义不含糊，特定，和业务领域命名一致</li>
<li>注释，简单，实例，描述为什么这样的理由，todo，站在读者的立场</li>
</ul>
<h3 id="简化循环和逻辑"><a href="#简化循环和逻辑" class="headerlink" title="简化循环和逻辑"></a>简化循环和逻辑</h3><ul>
<li>if/esle的考量，正逻辑还是负逻辑更好理解</li>
<li>避免do/while</li>
<li>提前返回</li>
<li>最小嵌套</li>
<li>拆分巨大的语句</li>
<li>变量命名，缩小变量作用域</li>
</ul>
<h3 id="重新组织代码"><a href="#重新组织代码" class="headerlink" title="重新组织代码"></a>重新组织代码</h3><ul>
<li>抽取不想关的子逻到工具类或者其他相关领域</li>
<li>小函数也不需要太多</li>
<li>一次只做一件事情，通过组合函数或者类来解决大问题</li>
</ul>
<h3 id="想法变成代码"><a href="#想法变成代码" class="headerlink" title="想法变成代码"></a>想法变成代码</h3><p>使用自然语言程序描述功能，描述解决问题的流程</p>
<h2 id="少些代码"><a href="#少些代码" class="headerlink" title="少些代码"></a>少些代码</h2><ul>
<li>少量代码解决最重要的问题，介绍需求</li>
<li>使用现有工具，unix tools/现有代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat *.log | awk `&#123;print $5 &quot; &quot; $7&#125;` | egrep &quot;[45]..$&quot; \</span><br><span class="line">| sort | uniq -c | sort -nr</span><br></pre></td></tr></table></figure>

<h2 id="精选话题"><a href="#精选话题" class="headerlink" title="精选话题"></a>精选话题</h2><ul>
<li>测试可读性</li>
<li>详细的错误信息</li>
<li>测试函数命名</li>
<li>可测性衡量-Hard<ul>
<li>全局变量</li>
<li>外部组件大量依赖代码</li>
<li>代码不确定行为</li>
</ul>
</li>
<li>可测性衡量-好<ul>
<li>内部状态很少</li>
<li>类函数只做一件事情</li>
<li>依赖很少，可管理</li>
<li>函数接口简单</li>
</ul>
</li>
<li>测试代码需要描述清楚测试的功能，高层定义越简单越好</li>
</ul>
<h3 id="深入阅读推荐"><a href="#深入阅读推荐" class="headerlink" title="深入阅读推荐"></a>深入阅读推荐</h3><ul>
<li>Code Complete</li>
<li>Refactoring</li>
<li>The Pragmatic Programer</li>
<li>Javascript - The Good Parts</li>
<li>Effective Java</li>
<li>Design-Pattern: Elements of Reusable Object-Oriented Software</li>
<li>Programming Pearls</li>
<li><a href="http://www.joeonsoftware.com" target="_blank" rel="noopener">Joel on Software</a></li>
<li>Donald E.Knuth books </li>
</ul>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/Notes/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>Notes</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
    
  </section>
  
    
    <!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
    
    

  


	
</div>
<aside class='l_side'>
  
    
    
      
        
          
          
            <section class='widget author'>
  <div class='content material'>
    
      <div class='avatar'>
        <img class='avatar' src='https://cdn.jsdelivr.net/gh/xaoxuu/assets@master/avatar/avatar.png'/>
      </div>
    
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml"
              class="social fas fa-rss flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@xaoxuu.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/xaoxuu"
              class="social fab fa-github flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=63035382"
              class="social fas fa-headphones-alt flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

          
        
      
        
          
          
            

          
        
      
        
          
          
            <section class='widget grid'>
  
<header class='material'>
  <div><i class="fas fa-map-signs fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;站内导航</div>
  
</header>

  <div class='content material'>
    <ul class="grid navgation">
      
        <li><a class="flat-box" title="/" href="/"
          
          
          id="home">
          
            <i class="fas fa-clock fa-fw" aria-hidden="true"></i>
          
          近期文章
        </a></li>
      
        <li><a class="flat-box" title="/blog/archives/" href="/blog/archives/"
          
            rel="nofollow"
          
          
          id="blogarchives">
          
            <i class="fas fa-archive fa-fw" aria-hidden="true"></i>
          
          文章归档
        </a></li>
      
        <li><a class="flat-box" title="/projects/" href="/projects/"
          
          
          id="projects">
          
            <i class="fas fa-code-branch fa-fw" aria-hidden="true"></i>
          
          开源项目
        </a></li>
      
        <li><a class="flat-box" title="/friends/" href="/friends/"
          
            rel="nofollow"
          
          
          id="friends">
          
            <i class="fas fa-link fa-fw" aria-hidden="true"></i>
          
          我的友链
        </a></li>
      
        <li><a class="flat-box" title="https://xaoxuu.com/wiki/material-x/" href="https://xaoxuu.com/wiki/material-x/"
          
            rel="nofollow"
          
          
          id="https:xaoxuu.comwikimaterial-x">
          
            <i class="fas fa-book fa-fw" aria-hidden="true"></i>
          
          主题文档
        </a></li>
      
        <li><a class="flat-box" title="/about/" href="/about/"
          
            rel="nofollow"
          
          
          id="about">
          
            <i class="fas fa-info-circle fa-fw" aria-hidden="true"></i>
          
          关于小站
        </a></li>
      
    </ul>
  </div>
</section>

          
        
      
        
          
          
            

          
        
      
        
          
          
            
  <section class='widget tagcloud'>
    
<header class='material'>
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;热门标签</div>
  
    <a class="rightBtn"
    
      rel="nofollow"
    
    
    href="/blog/tags/"
    title="blog/tags/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class='content material'>
      <a href="/tags/API-Testing/" style="font-size: 19px; color: #777">API Testing</a> <a href="/tags/Automation/" style="font-size: 16.5px; color: #888">Automation</a> <a href="/tags/CI-CD/" style="font-size: 19px; color: #777">CI/CD</a> <a href="/tags/CICD/" style="font-size: 14px; color: #999">CICD</a> <a href="/tags/JAVA/" style="font-size: 14px; color: #999">JAVA</a> <a href="/tags/MAVEN/" style="font-size: 14px; color: #999">MAVEN</a> <a href="/tags/Notes/" style="font-size: 14px; color: #999">Notes</a> <a href="/tags/Performance/" style="font-size: 14px; color: #999">Performance</a> <a href="/tags/Project-Setup/" style="font-size: 14px; color: #999">Project Setup</a> <a href="/tags/Python/" style="font-size: 14px; color: #999">Python</a> <a href="/tags/TDD/" style="font-size: 14px; color: #999">TDD</a> <a href="/tags/ThinkInTesting/" style="font-size: 14px; color: #999">ThinkInTesting</a> <a href="/tags/ThreadDump/" style="font-size: 14px; color: #999">ThreadDump</a> <a href="/tags/Tip/" style="font-size: 14px; color: #999">Tip</a> <a href="/tags/agile-metrics/" style="font-size: 14px; color: #999">agile metrics</a> <a href="/tags/algorithm/" style="font-size: 14px; color: #999">algorithm</a> <a href="/tags/annaconda3/" style="font-size: 14px; color: #999">annaconda3</a> <a href="/tags/ansible/" style="font-size: 16.5px; color: #888">ansible</a> <a href="/tags/cheatsheet/" style="font-size: 14px; color: #999">cheatsheet</a> <a href="/tags/concurrent/" style="font-size: 14px; color: #999">concurrent</a> <a href="/tags/git/" style="font-size: 14px; color: #999">git</a> <a href="/tags/google-test-blog-translation/" style="font-size: 14px; color: #999">google_test_blog_translation</a> <a href="/tags/interview/" style="font-size: 14px; color: #999">interview</a> <a href="/tags/java/" style="font-size: 21.5px; color: #666">java</a> <a href="/tags/junit/" style="font-size: 14px; color: #999">junit</a> <a href="/tags/justdoit/" style="font-size: 14px; color: #999">justdoit</a> <a href="/tags/ops/" style="font-size: 14px; color: #999">ops</a> <a href="/tags/patterns/" style="font-size: 24px; color: #555">patterns</a> <a href="/tags/performance/" style="font-size: 14px; color: #999">performance</a> <a href="/tags/productivity/" style="font-size: 16.5px; color: #888">productivity</a> <a href="/tags/python/" style="font-size: 16.5px; color: #888">python</a> <a href="/tags/real/" style="font-size: 21.5px; color: #666">real</a> <a href="/tags/testing/" style="font-size: 19px; color: #777">testing</a> <a href="/tags/think-different/" style="font-size: 16.5px; color: #888">think-different</a> <a href="/tags/thoughts/" style="font-size: 14px; color: #999">thoughts</a> <a href="/tags/tips/" style="font-size: 21.5px; color: #666">tips</a> <a href="/tags/ut/" style="font-size: 14px; color: #999">ut</a> <a href="/tags/word-frequency/" style="font-size: 14px; color: #999">word_frequency</a>
    </div>
  </section>


          
        
      
        
          
          
            



          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="/atom.xml"
            class="social fas fa-rss flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:me@xaoxuu.com"
            class="social fas fa-envelope flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/xaoxuu"
            class="social fab fa-github flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://music.163.com/#/user/home?id=63035382"
            class="social fas fa-headphones-alt flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
  <div>
    本站使用
    <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a>
    作为主题
    
      ，
      总访问量为
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      次
    
    。
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>




	<!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
	

	


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://img.vim-cn.com/6d/a0c9e6f9efad8b731cb7376504bd10d79d2053.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          ["https://img.vim-cn.com/6d/a0c9e6f9efad8b731cb7376504bd10d79d2053.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  











  <script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/js/app.js"></script>


  <script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>
